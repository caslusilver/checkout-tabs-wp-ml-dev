================================================================================
  ğŸ”§ GUIA COMPLETO DE CORREÃ‡Ã•ES - CHECKOUT TABS WP ML
  ğŸ“… Data: 06/01/2026
  ğŸ“Š Status: FUNCIONAL COM PROBLEMAS CRÃTICOS
  ğŸ¯ Objetivo: Documento Ãºnico para implementaÃ§Ã£o de todas as correÃ§Ãµes
================================================================================

Este documento consolida TODOS os problemas identificados nos testes e fornece
instruÃ§Ãµes detalhadas de implementaÃ§Ã£o. Use este documento como referÃªncia
Ãºnica para realizar todas as correÃ§Ãµes necessÃ¡rias.


================================================================================
ğŸ“‹ ÃNDICE DE PROBLEMAS
================================================================================

ğŸ”´ PROBLEMAS CRÃTICOS (PRIORIDADE MÃXIMA):
   1. Erro JavaScript: SyntaxError: '.' is not a valid selector (27+ ocorrÃªncias)
   2. Falha ao salvar dados: store_webhook_shipping retorna success=false
   3. Sem mensagem de sucesso ao salvar endereÃ§o â­ NOVO
   4. NÃºmero do WhatsApp nÃ£o salva no perfil â­ NOVO

ğŸŸ¡ PROBLEMAS DE SEGURANÃ‡A E UX (ALTA PRIORIDADE):
   5. reCAPTCHA nÃ£o integrado ao formulÃ¡rio de "Criar conta"
   6. Link "Esqueci minha senha" ausente no login

ğŸŸ  PROBLEMAS DE LAYOUT (MÃ‰DIA PRIORIDADE):
   7. BotÃ£o de login nÃ£o ocupa 100% e cor incorreta
   8. Fundo azul nas abas (influÃªncia do Elementor)

âš ï¸  PROBLEMAS DE PERFORMANCE (MÃ‰DIA PRIORIDADE):
   9. EndereÃ§os demoram para aparecer apÃ³s login (sem feedback visual)
   10. Processamento lento (3-5 segundos, esperado: < 2s)
   11. MÃºltiplos update_checkout simultÃ¢neos


================================================================================
ğŸ”´ PROBLEMA #1: ERRO JAVASCRIPT - SELETOR CSS INVÃLIDO
================================================================================

DESCRIÃ‡ÃƒO DO PROBLEMA:
  â€¢ Erro: SyntaxError: '.' is not a valid selector
  â€¢ FrequÃªncia: 27+ ocorrÃªncias nos logs fornecidos
  â€¢ Causa: CÃ³digo JavaScript tentando usar jQuery com seletores vazios
  â€¢ Exemplo: $('.' + variavelVazia) resulta em $('.')
  â€¢ Impacto: CRÃTICO - Pode causar falhas silenciosas em toda a aplicaÃ§Ã£o

LOGS RELEVANTES:
  [17:02:13] ERROR window.error: SyntaxError: '.' is not a valid selector
  [17:58:10] ERROR window.error: SyntaxError: '.' is not a valid selector
  [18:11:25] ERROR window.error: SyntaxError: '.' is not a valid selector
  (... 24+ ocorrÃªncias similares)


ARQUIVOS A MODIFICAR:
  â€¢ assets/js/checkout-tabs.js
  â€¢ assets/js/tabs.js
  â€¢ assets/js/ui.js
  â€¢ Qualquer arquivo que use seletores CSS dinÃ¢micos


SOLUÃ‡ÃƒO - PASSO 1: Criar funÃ§Ã£o helper de seleÃ§Ã£o segura
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Adicionar no INÃCIO de assets/js/checkout-tabs.js (ou tabs.js):

```javascript
/**
 * FunÃ§Ã£o helper para criar seletores jQuery de forma segura.
 * Previne o erro "SyntaxError: '.' is not a valid selector"
 * 
 * @param {string} selector - Seletor CSS (pode incluir classe ou ID)
 * @param {string} prefix - Prefixo opcional ('.', '#', etc)
 * @returns {jQuery} Objeto jQuery (vazio se seletor invÃ¡lido)
 */
function safeSelector(selector, prefix) {
    // ValidaÃ§Ãµes bÃ¡sicas
    if (!selector || typeof selector !== 'string') {
        console.warn('[CTWPML] Seletor invÃ¡lido (nÃ£o Ã© string):', selector);
        return jQuery();
    }
    
    selector = selector.trim();
    
    // Verifica se Ã© apenas o prefixo (ex: sÃ³ '.' ou '#')
    if (!selector || selector === '.' || selector === '#' || selector === '') {
        console.warn('[CTWPML] Seletor vazio ou apenas prefixo:', selector);
        return jQuery();
    }
    
    // Adiciona prefixo se fornecido
    if (prefix) {
        selector = prefix + selector;
    }
    
    // Tenta criar o seletor com try/catch
    try {
        return jQuery(selector);
    } catch (e) {
        console.error('[CTWPML] Erro ao criar seletor:', selector, e);
        return jQuery();
    }
}

/**
 * VersÃ£o especÃ­fica para classes (adiciona '.' automaticamente)
 */
function safeClass(className) {
    return safeSelector(className, '.');
}

/**
 * VersÃ£o especÃ­fica para IDs (adiciona '#' automaticamente)
 */
function safeId(idName) {
    return safeSelector(idName, '#');
}
```


SOLUÃ‡ÃƒO - PASSO 2: Identificar e substituir seletores perigosos
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Buscar em TODOS os arquivos JavaScript por padrÃµes como:

PADRÃƒO PERIGOSO 1: $('.' + variavel)
Substituir por: safeClass(variavel)

PADRÃƒO PERIGOSO 2: $('#' + variavel)
Substituir por: safeId(variavel)

PADRÃƒO PERIGOSO 3: $(variavel) onde variavel pode ser string dinÃ¢mica
Substituir por: safeSelector(variavel)


EXEMPLO DE CORREÃ‡ÃƒO:

ANTES (PERIGOSO):
```javascript
var className = getElementClass(); // Pode retornar string vazia
var $element = $('.' + className); // ERRO se className === ''
$element.hide();
```

DEPOIS (SEGURO):
```javascript
var className = getElementClass();
var $element = safeClass(className); // Retorna jQuery() vazio se invÃ¡lido
if ($element.length) {
    $element.hide();
}
```


SOLUÃ‡ÃƒO - PASSO 3: Adicionar validaÃ§Ãµes em configuraÃ§Ãµes
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Se houver leitura de configuraÃ§Ãµes do WordPress/Elementor:

```javascript
// Exemplo: lendo classe de configuraÃ§Ã£o
var config = window.cc_params || {};
var elementClass = config.element_class || '';

// SEMPRE validar antes de usar
if (elementClass && elementClass.trim()) {
    var $element = safeClass(elementClass.trim());
    // ... usar elemento ...
} else {
    console.warn('[CTWPML] ConfiguraÃ§Ã£o element_class nÃ£o definida ou vazia');
}
```


ESTIMATIVA DE TEMPO: 2-3 horas (busca + substituiÃ§Ã£o + testes)
PRIORIDADE: ğŸ”´ CRÃTICA


================================================================================
ğŸ”´ PROBLEMA #2: FALHA AO SALVAR DADOS (store_webhook_shipping)
================================================================================

DESCRIÃ‡ÃƒO DO PROBLEMA:
  â€¢ Erro: store_webhook_shipping retornou success=false
  â€¢ Contexto: ApÃ³s consulta de CEP/endereÃ§o via webhook
  â€¢ Impacto: CRÃTICO - Dados de frete nÃ£o sÃ£o salvos, perda de informaÃ§Ã£o
  â€¢ Log: [18:12:42] ERROR store_webhook_shipping retornou success=false

TIMELINE DO ERRO:
  [18:12:39] UsuÃ¡rio clicou em "AvanÃ§ar" (CEP -> EndereÃ§o)
  [18:12:39] Iniciou consulta via webhook
  [18:12:41] Webhook retornou dados normalizados
  [18:12:41] Tentou salvar via store_webhook_shipping
  [18:12:42] âŒ ERRO: success=false


ARQUIVO A MODIFICAR:
  â€¢ inc/ajax-store-webhook-shipping.php


SOLUÃ‡ÃƒO - PASSO 1: Adicionar logs detalhados
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

No INÃCIO da funÃ§Ã£o store_webhook_shipping:

```php
<?php
// No inÃ­cio da aÃ§Ã£o AJAX
error_log('[CTWPML] store_webhook_shipping - INICIANDO');
error_log('[CTWPML] POST data: ' . print_r($_POST, true));
error_log('[CTWPML] User ID: ' . get_current_user_id());
error_log('[CTWPML] User logged in: ' . (is_user_logged_in() ? 'yes' : 'no'));
```


SOLUÃ‡ÃƒO - PASSO 2: Validar permissÃµes e autenticaÃ§Ã£o
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

```php
<?php
// Verificar se usuÃ¡rio estÃ¡ logado
if (!is_user_logged_in()) {
    error_log('[CTWPML] store_webhook_shipping - ERRO: UsuÃ¡rio nÃ£o logado');
    wp_send_json_error([
        'message' => 'UsuÃ¡rio nÃ£o autenticado. FaÃ§a login para salvar dados.'
    ]);
    return;
}

$user_id = get_current_user_id();
error_log('[CTWPML] store_webhook_shipping - User ID vÃ¡lido: ' . $user_id);

// Verificar nonce (se estiver sendo usado)
if (isset($_POST['_ajax_nonce'])) {
    if (!check_ajax_referer('ctwpml_addresses', '_ajax_nonce', false)) {
        error_log('[CTWPML] store_webhook_shipping - ERRO: Nonce invÃ¡lido');
        wp_send_json_error([
            'message' => 'Nonce invÃ¡lido. Recarregue a pÃ¡gina e tente novamente.'
        ]);
        return;
    }
    error_log('[CTWPML] store_webhook_shipping - Nonce vÃ¡lido');
}
```


SOLUÃ‡ÃƒO - PASSO 3: Validar dados recebidos
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

```php
<?php
// Validar campos obrigatÃ³rios (ajustar conforme necessÃ¡rio)
$dados_raw = isset($_POST['raw_data']) ? $_POST['raw_data'] : '';
$dados_normalized = isset($_POST['normalized_data']) ? $_POST['normalized_data'] : '';

if (empty($dados_raw) && empty($dados_normalized)) {
    error_log('[CTWPML] store_webhook_shipping - ERRO: Nenhum dado fornecido');
    wp_send_json_error([
        'message' => 'Nenhum dado fornecido para salvar.'
    ]);
    return;
}

error_log('[CTWPML] store_webhook_shipping - Dados recebidos OK');

// Decodificar JSON se necessÃ¡rio
if (is_string($dados_normalized)) {
    $dados_normalized = json_decode(stripslashes($dados_normalized), true);
    if (json_last_error() !== JSON_ERROR_NONE) {
        error_log('[CTWPML] store_webhook_shipping - ERRO JSON: ' . json_last_error_msg());
        wp_send_json_error([
            'message' => 'Erro ao decodificar dados: ' . json_last_error_msg()
        ]);
        return;
    }
}
```


SOLUÃ‡ÃƒO - PASSO 4: Salvar com tratamento de erro
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

```php
<?php
// Tentar salvar dados
$meta_key = '_ctwpml_webhook_shipping_data';
$result = update_user_meta($user_id, $meta_key, $dados_normalized);

if ($result === false) {
    error_log('[CTWPML] store_webhook_shipping - ERRO: Falha ao salvar user_meta');
    wp_send_json_error([
        'message' => 'Erro ao salvar dados no banco de dados.'
    ]);
    return;
}

error_log('[CTWPML] store_webhook_shipping - SUCESSO: Dados salvos');
error_log('[CTWPML] Dados salvos: ' . print_r($dados_normalized, true));

wp_send_json_success([
    'message' => 'Dados de frete salvos com sucesso.',
    'data' => $dados_normalized
]);
```


ESTIMATIVA DE TEMPO: 1-2 horas (investigaÃ§Ã£o + correÃ§Ã£o + testes)
PRIORIDADE: ğŸ”´ CRÃTICA


================================================================================
ğŸ”´ PROBLEMA #3: SEM MENSAGEM DE SUCESSO AO SALVAR ENDEREÃ‡O â­ NOVO
================================================================================

DESCRIÃ‡ÃƒO DO PROBLEMA:
  â€¢ Quando usuÃ¡rio clica em "Salvar" na ediÃ§Ã£o de endereÃ§o, nenhuma mensagem aparece
  â€¢ UsuÃ¡rio nÃ£o sabe se o endereÃ§o foi salvo com sucesso
  â€¢ Sem feedback visual de confirmaÃ§Ã£o
  â€¢ UX ruim: falta de clareza sobre o resultado da aÃ§Ã£o


ARQUIVO A MODIFICAR:
  â€¢ assets/js/address-ml-modal.js


SOLUÃ‡ÃƒO - PASSO 1: Criar funÃ§Ã£o de notificaÃ§Ã£o
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Adicionar APÃ“S a linha 16 em assets/js/address-ml-modal.js:

```javascript
/**
 * Exibe notificaÃ§Ã£o toast para o usuÃ¡rio
 * @param {string} message - Mensagem a exibir
 * @param {string} type - Tipo: 'success' ou 'error'
 * @param {number} duration - DuraÃ§Ã£o em ms (padrÃ£o: 3000)
 */
function showNotification(message, type, duration) {
    type = type || 'success';
    duration = duration || 3000;
    
    var bgColor = type === 'success' ? '#067647' : '#b42318';
    var textColor = '#fff';
    var icon = type === 'success' ? 'âœ“' : 'âœ•';
    
    var $notif = $('<div class="ctwpml-notification">')
        .html('<span class="ctwpml-notification-icon">' + icon + '</span>' + 
              '<span class="ctwpml-notification-text">' + String(message) + '</span>')
        .css({
            'position': 'fixed',
            'top': '20px',
            'left': '50%',
            'transform': 'translateX(-50%)',
            'background-color': bgColor,
            'color': textColor,
            'padding': '14px 24px',
            'border-radius': '8px',
            'font-weight': '700',
            'font-size': '15px',
            'z-index': '999999',
            'box-shadow': '0 4px 16px rgba(0,0,0,0.2)',
            'opacity': '0',
            'transition': 'opacity 0.3s ease',
            'display': 'flex',
            'align-items': 'center',
            'gap': '10px',
            'max-width': '90%',
            'text-align': 'center'
        });
    
    $('body').append($notif);
    
    // Fade in
    setTimeout(function() {
        $notif.css('opacity', '1');
    }, 100);
    
    // Fade out e remover
    setTimeout(function() {
        $notif.css('opacity', '0');
        setTimeout(function() {
            $notif.remove();
        }, 300);
    }, duration);
    
    // Log para debug
    logAny('NotificaÃ§Ã£o exibida: ' + message, { type: type });
}
```


SOLUÃ‡ÃƒO - PASSO 2: Adicionar notificaÃ§Ã£o ao salvar endereÃ§o
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Localizar a funÃ§Ã£o saveAddressFromForm (linha ~683) e modificar o success callback:

ANTES:
```javascript
success: function (resp) {
    isSavingAddress = false;
    $('#ctwpml-btn-primary').prop('disabled', false);
    if (resp && resp.success && resp.data) {
        if (Array.isArray(resp.data.items)) addressesCache = dedupeAddresses(resp.data.items);
        if (resp.data.item && resp.data.item.id) selectedAddressId = resp.data.item.id;
        done({ ok: true });
    } else {
        done({ ok: false, message: (resp && resp.data) || 'Erro ao salvar endereÃ§o.' });
    }
}
```

DEPOIS:
```javascript
success: function (resp) {
    isSavingAddress = false;
    $('#ctwpml-btn-primary').prop('disabled', false);
    
    if (resp && resp.success && resp.data) {
        if (Array.isArray(resp.data.items)) {
            addressesCache = dedupeAddresses(resp.data.items);
        }
        if (resp.data.item && resp.data.item.id) {
            selectedAddressId = resp.data.item.id;
        }
        
        // â­ NOVO: Mostrar notificaÃ§Ã£o de sucesso
        showNotification('EndereÃ§o salvo com sucesso!', 'success', 2500);
        
        done({ ok: true });
    } else {
        var errorMsg = (resp && resp.data && resp.data.message) || 
                       (resp && resp.data) || 
                       'Erro ao salvar endereÃ§o.';
        
        // â­ NOVO: Mostrar notificaÃ§Ã£o de erro
        showNotification(errorMsg, 'error', 4000);
        
        done({ ok: false, message: errorMsg });
    }
},
error: function () {
    isSavingAddress = false;
    $('#ctwpml-btn-primary').prop('disabled', false);
    
    // â­ NOVO: Mostrar notificaÃ§Ã£o de erro
    showNotification('Erro ao salvar endereÃ§o. Tente novamente.', 'error', 4000);
    
    done({ ok: false, message: 'Erro ao salvar endereÃ§o.' });
}
```


SOLUÃ‡ÃƒO - PASSO 3: Retornar para lista apÃ³s salvar
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Localizar o binding do botÃ£o primÃ¡rio (linha ~1184) e modificar:

ANTES:
```javascript
saveContactMeta(function () {
    saveAddressFromForm(function (res) {
        if (!res || !res.ok) {
            alert((res && res.message) || 'Erro ao salvar endereÃ§o.');
            return;
        }
        showList();
        renderAddressList();
    });
});
```

DEPOIS:
```javascript
saveContactMeta(function () {
    saveAddressFromForm(function (res) {
        if (!res || !res.ok) {
            // NÃ£o precisa alert aqui, jÃ¡ tem notificaÃ§Ã£o
            return;
        }
        
        // â­ NOVO: Aguardar 800ms para usuÃ¡rio ver a confirmaÃ§Ã£o
        setTimeout(function() {
            showList();
            renderAddressList();
        }, 800);
    });
});
```


ESTIMATIVA DE TEMPO: 45 minutos
PRIORIDADE: ğŸ”´ CRÃTICA


================================================================================
ğŸ”´ PROBLEMA #4: WHATSAPP NÃƒO SALVA NO PERFIL â­ NOVO
================================================================================

DESCRIÃ‡ÃƒO DO PROBLEMA:
  â€¢ UsuÃ¡rio edita o nÃºmero do WhatsApp no modal de endereÃ§os
  â€¢ Ao salvar, o WhatsApp nÃ£o fica persistido no perfil do usuÃ¡rio
  â€¢ Na prÃ³xima vez que abre o modal, o campo estÃ¡ vazio
  â€¢ Dados nÃ£o estÃ£o sendo enviados ou salvos corretamente


ARQUIVOS A MODIFICAR:
  â€¢ assets/js/address-ml-modal.js (verificar envio)
  â€¢ inc/frontend/addresses-api.php (verificar salvamento)


SOLUÃ‡ÃƒO - PASSO 1: Verificar envio do WhatsApp
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Na funÃ§Ã£o saveContactMeta (linha ~276), verificar se estÃ¡ enviando corretamente:

```javascript
function saveContactMeta(callback) {
    if (!state.params || !state.params.is_logged_in) {
        if (callback) callback();
        return;
    }

    // â­ IMPORTANTE: Remover mÃ¡scara do WhatsApp antes de enviar
    var whatsappRaw = $('#ctwpml-input-fone').val() || '';
    var whatsappDigits = phoneDigits(whatsappRaw); // Remove formataÃ§Ã£o
    var cpfRaw = $('#ctwpml-input-cpf').val() || '';
    var cpfDigits = cpfDigitsOnly(cpfRaw); // Remove formataÃ§Ã£o

    // â­ LOG para debug
    logAny('Salvando dados de contato', { 
        whatsapp: whatsappDigits, 
        cpf: cpfDigits 
    });

    showModalSpinner();

    $.ajax({
        url: state.params.ajax_url,
        type: 'POST',
        data: {
            action: 'ctwpml_save_contact_meta',
            whatsapp: whatsappDigits, // â­ Envia sÃ³ dÃ­gitos
            cpf: cpfDigits             // â­ Envia sÃ³ dÃ­gitos
        },
        success: function (response) {
            if (response && response.success) {
                logAny('Dados de contato salvos com sucesso', response.data);
                
                if (response.data && response.data.cpf_locked) {
                    $('#ctwpml-input-cpf').prop('readonly', true);
                    $('#ctwpml-generate-cpf-modal').hide();
                }
                
                // â­ NOVO: Exibir notificaÃ§Ã£o de sucesso
                showNotification('Dados salvos com sucesso!', 'success', 2000);
            } else {
                // â­ NOVO: Exibir notificaÃ§Ã£o de erro
                var errorMsg = (response && response.data && response.data.message) || 
                               'Erro ao salvar dados de contato';
                showNotification(errorMsg, 'error', 3000);
                logAny('Erro ao salvar dados de contato', response);
            }
            if (callback) callback(response);
        },
        error: function (xhr, status, error) {
            logAny('Erro AJAX ao salvar dados de contato', { 
                status: status, 
                error: error,
                responseText: xhr.responseText 
            });
            
            // â­ NOVO: Exibir notificaÃ§Ã£o de erro
            showNotification('Erro ao salvar dados. Tente novamente.', 'error', 3000);
            
            if (callback) callback();
        },
        complete: function () {
            hideModalSpinner();
        }
    });
}
```


SOLUÃ‡ÃƒO - PASSO 2: Verificar salvamento no backend
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Arquivo: inc/frontend/addresses-api.php (ou onde estÃ¡ a aÃ§Ã£o 'ctwpml_save_contact_meta')

Adicionar/verificar esta aÃ§Ã£o AJAX:

```php
<?php
/**
 * AJAX: Salvar dados de contato (WhatsApp e CPF) no perfil do usuÃ¡rio
 */
add_action('wp_ajax_ctwpml_save_contact_meta', function() {
    error_log('[CTWPML] save_contact_meta - INICIANDO');
    
    // Verificar autenticaÃ§Ã£o
    if (!is_user_logged_in()) {
        error_log('[CTWPML] save_contact_meta - ERRO: UsuÃ¡rio nÃ£o logado');
        wp_send_json_error(['message' => 'UsuÃ¡rio nÃ£o autenticado']);
        return;
    }
    
    $user_id = get_current_user_id();
    error_log('[CTWPML] save_contact_meta - User ID: ' . $user_id);
    
    // Receber dados
    $whatsapp = isset($_POST['whatsapp']) ? sanitize_text_field($_POST['whatsapp']) : '';
    $cpf = isset($_POST['cpf']) ? sanitize_text_field($_POST['cpf']) : '';
    
    error_log('[CTWPML] save_contact_meta - WhatsApp recebido: ' . $whatsapp);
    error_log('[CTWPML] save_contact_meta - CPF recebido: ' . $cpf);
    
    $updated = false;
    
    // Salvar WhatsApp
    if (!empty($whatsapp)) {
        // Remove tudo que nÃ£o for dÃ­gito
        $whatsapp_digits = preg_replace('/\D/', '', $whatsapp);
        
        if (strlen($whatsapp_digits) >= 10 && strlen($whatsapp_digits) <= 11) {
            update_user_meta($user_id, '_ctwpml_whatsapp', $whatsapp_digits);
            error_log('[CTWPML] save_contact_meta - WhatsApp salvo: ' . $whatsapp_digits);
            $updated = true;
        } else {
            error_log('[CTWPML] save_contact_meta - WhatsApp invÃ¡lido: ' . $whatsapp_digits);
        }
    }
    
    // Verificar se CPF jÃ¡ estÃ¡ travado
    $cpf_locked = get_user_meta($user_id, '_ctwpml_cpf_locked', true);
    
    // Salvar CPF (se nÃ£o estiver travado)
    if (!empty($cpf) && !$cpf_locked) {
        // Remove tudo que nÃ£o for dÃ­gito
        $cpf_digits = preg_replace('/\D/', '', $cpf);
        
        if (strlen($cpf_digits) === 11) {
            update_user_meta($user_id, '_ctwpml_cpf', $cpf_digits);
            
            // Travar CPF permanentemente apÃ³s primeiro salvamento
            update_user_meta($user_id, '_ctwpml_cpf_locked', true);
            $cpf_locked = true;
            
            error_log('[CTWPML] save_contact_meta - CPF salvo e travado: ' . $cpf_digits);
            $updated = true;
        } else {
            error_log('[CTWPML] save_contact_meta - CPF invÃ¡lido: ' . $cpf_digits);
        }
    }
    
    if ($updated) {
        error_log('[CTWPML] save_contact_meta - SUCESSO');
        wp_send_json_success([
            'message' => 'Dados salvos com sucesso',
            'cpf_locked' => $cpf_locked
        ]);
    } else {
        error_log('[CTWPML] save_contact_meta - Nenhum dado vÃ¡lido para salvar');
        wp_send_json_error([
            'message' => 'Nenhum dado vÃ¡lido fornecido'
        ]);
    }
});
```


SOLUÃ‡ÃƒO - PASSO 3: Verificar carregamento dos dados
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Na funÃ§Ã£o loadContactMeta (linha ~238), verificar se estÃ¡ carregando corretamente:

```javascript
function loadContactMeta() {
    if (!state.params || !state.params.is_logged_in) {
        return;
    }

    // â­ LOG para debug
    logAny('Carregando dados de contato do perfil...', {});

    $.ajax({
        url: state.params.ajax_url,
        type: 'POST',
        data: {
            action: 'ctwpml_get_contact_meta',
        },
        success: function (response) {
            if (response && response.success && response.data) {
                var whatsapp = response.data.whatsapp || '';
                var cpf = response.data.cpf || '';
                var cpfLocked = response.data.cpf_locked || false;

                // â­ LOG para debug
                logAny('Dados de contato carregados', { 
                    whatsapp: whatsapp, 
                    cpf: cpf,
                    cpfLocked: cpfLocked 
                });

                if (whatsapp) {
                    $('#ctwpml-input-fone').val(formatPhone(whatsapp));
                }

                if (cpf) {
                    $('#ctwpml-input-cpf').val(formatCpf(cpf));
                    if (cpfLocked) {
                        $('#ctwpml-input-cpf').prop('readonly', true);
                        $('#ctwpml-generate-cpf-modal').hide();
                    }
                }
            } else {
                logAny('Nenhum dado de contato encontrado no perfil', {});
            }
        },
        error: function (xhr, status, error) {
            logAny('Erro ao carregar dados de contato', { 
                status: status, 
                error: error 
            });
        }
    });
}
```


SOLUÃ‡ÃƒO - PASSO 4: Adicionar aÃ§Ã£o de carregamento no backend
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

```php
<?php
/**
 * AJAX: Carregar dados de contato (WhatsApp e CPF) do perfil do usuÃ¡rio
 */
add_action('wp_ajax_ctwpml_get_contact_meta', function() {
    error_log('[CTWPML] get_contact_meta - INICIANDO');
    
    if (!is_user_logged_in()) {
        error_log('[CTWPML] get_contact_meta - ERRO: UsuÃ¡rio nÃ£o logado');
        wp_send_json_error(['message' => 'UsuÃ¡rio nÃ£o autenticado']);
        return;
    }
    
    $user_id = get_current_user_id();
    
    $whatsapp = get_user_meta($user_id, '_ctwpml_whatsapp', true);
    $cpf = get_user_meta($user_id, '_ctwpml_cpf', true);
    $cpf_locked = get_user_meta($user_id, '_ctwpml_cpf_locked', true);
    
    error_log('[CTWPML] get_contact_meta - WhatsApp: ' . $whatsapp);
    error_log('[CTWPML] get_contact_meta - CPF: ' . $cpf);
    error_log('[CTWPML] get_contact_meta - CPF locked: ' . ($cpf_locked ? 'yes' : 'no'));
    
    wp_send_json_success([
        'whatsapp' => $whatsapp,
        'cpf' => $cpf,
        'cpf_locked' => (bool) $cpf_locked
    ]);
});
```


ESTIMATIVA DE TEMPO: 1-1.5 horas
PRIORIDADE: ğŸ”´ CRÃTICA


================================================================================
ğŸŸ¡ PROBLEMA #5: RECAPTCHA NÃƒO INTEGRADO EM "CRIAR CONTA"
================================================================================

DESCRIÃ‡ÃƒO DO PROBLEMA:
  â€¢ O formulÃ¡rio de "Criar conta" nÃ£o tem reCAPTCHA
  â€¢ VulnerÃ¡vel a bots e cadastros automatizados
  â€¢ Plugin de referÃªncia jÃ¡ tem implementaÃ§Ã£o funcionando perfeitamente
  â€¢ Basta copiar e adaptar do plugin de referÃªncia


ğŸ“ ARQUIVO DE REFERÃŠNCIA (COPIAR IMPLEMENTAÃ‡ÃƒO DESTE):
   C:\Users\Dell\Desktop\checkout-tab-estilo-ml-2026\dados de entrega\
   popup login que tem recaptcha\plugin de popup de login que tem recatpcha.php


ARQUIVOS A MODIFICAR:
  â€¢ inc/frontend/login-popup.php (adicionar reCAPTCHA no HTML)
  â€¢ assets/js/login-signup.js (validar reCAPTCHA antes do submit)


SOLUÃ‡ÃƒO - PASSO 1: Carregar script do reCAPTCHA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

No arquivo inc/frontend/login-popup.php, ANTES da linha 100 (antes do <script>):

```php
<?php
// Carregar script do reCAPTCHA
// IMPORTANTE: SÃ³ carregar se a sitekey estiver configurada
$site_key = get_option('checkout_tabs_wp_ml_recaptcha_site_key', '');
if (empty($site_key)) {
    $login_recaptcha_opts = get_option('login_nocaptcha_options', []);
    if (is_array($login_recaptcha_opts) && isset($login_recaptcha_opts['site_key'])) {
        $site_key = $login_recaptcha_opts['site_key'];
    }
}
?>
```

Depois, DENTRO do bloco <script> (linha ~100), ANTES do cÃ³digo existente:

```javascript
// Carregar script do reCAPTCHA se ainda nÃ£o estiver presente
if (!document.querySelector('script[src*="google.com/recaptcha"]')) {
    var recaptchaScript = document.createElement('script');
    recaptchaScript.src = 'https://www.google.com/recaptcha/api.js?onload=onloadCtwpmlCallback&render=explicit';
    recaptchaScript.async = true;
    recaptchaScript.defer = true;
    document.head.appendChild(recaptchaScript);
}
```


SOLUÃ‡ÃƒO - PASSO 2: Adicionar callbacks do reCAPTCHA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

No mesmo bloco <script>, adicionar ANTES do cÃ³digo jQuery:

```javascript
// Callbacks do reCAPTCHA (devem ser globais)
window.onloadCtwpmlCallback = function() {
    console.log('[CTWPML] reCAPTCHA API carregada');
};

window.ctwpmlSubmitEnable = function() {
    console.log('[CTWPML] reCAPTCHA validado');
    var btn = document.getElementById('ctwpml-signup-submit');
    if (btn) {
        btn.disabled = false;
        btn.style.opacity = '1';
    }
};

window.ctwpmlSubmitDisable = function() {
    console.log('[CTWPML] reCAPTCHA expirado');
    var btn = document.getElementById('ctwpml-signup-submit');
    if (btn) {
        btn.disabled = true;
        btn.style.opacity = '0.6';
    }
};
```


SOLUÃ‡ÃƒO - PASSO 3: Renderizar reCAPTCHA quando popup abrir
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

No arquivo assets/js/address-ml-modal.js, modificar a funÃ§Ã£o openLoginPopup (linha ~326):

ANTES:
```javascript
$.fancybox.open({
    src: '#login-popup',
    type: 'inline',
    touch: false,
    clickOutside: false,
    clickSlide: false,
    closeClickOutside: false,
    smallBtn: false,
    toolbar: false,
    buttons: [],
});
```

DEPOIS:
```javascript
$.fancybox.open({
    src: '#login-popup',
    type: 'inline',
    touch: false,
    clickOutside: false,
    clickSlide: false,
    closeClickOutside: false,
    smallBtn: false,
    toolbar: false,
    buttons: [],
    afterShow: function() {
        // â­ Renderizar reCAPTCHA no formulÃ¡rio de criar conta
        var $container = $('#ctwpml-recaptcha-container');
        if (typeof grecaptcha !== 'undefined' && $container.length && !$container.hasClass('recaptcha-rendered')) {
            try {
                grecaptcha.render('ctwpml-recaptcha-container', {
                    'sitekey': '<?php echo esc_attr($site_key); ?>',
                    'callback': window.ctwpmlSubmitEnable,
                    'expired-callback': window.ctwpmlSubmitDisable
                });
                $container.addClass('recaptcha-rendered');
                console.log('[CTWPML] reCAPTCHA renderizado com sucesso');
            } catch(e) {
                console.error('[CTWPML] Erro ao renderizar reCAPTCHA:', e);
            }
        }
    }
});
```


SOLUÃ‡ÃƒO - PASSO 4: Validar reCAPTCHA no submit
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

No arquivo assets/js/login-signup.js, a validaÃ§Ã£o JÃ EXISTE (linhas 44-49):

```javascript
// Validar reCAPTCHA v2
var recaptchaResponse = $('#ctwpml-recaptcha-container').find('.g-recaptcha-response').val();
if (!recaptchaResponse) {
    setMsg($msg, 'Por favor, complete o reCAPTCHA.', true);
    return;
}
```

âœ… Esta parte jÃ¡ estÃ¡ implementada corretamente!


SOLUÃ‡ÃƒO - PASSO 5: Validar reCAPTCHA no backend
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

No arquivo inc/ajax-signup.php (ou onde estÃ¡ a aÃ§Ã£o 'ctwpml_signup'):

```php
<?php
// Validar reCAPTCHA no servidor
$recaptcha_response = isset($_POST['recaptcha_response']) ? $_POST['recaptcha_response'] : '';

if (empty($recaptcha_response)) {
    error_log('[CTWPML] Signup - reCAPTCHA nÃ£o fornecido');
    wp_send_json_error(['message' => 'Por favor, complete o reCAPTCHA.']);
    return;
}

// Verificar reCAPTCHA com Google API
$secret_key = get_option('checkout_tabs_wp_ml_recaptcha_secret_key', '');
if (empty($secret_key)) {
    $login_recaptcha_opts = get_option('login_nocaptcha_options', []);
    if (is_array($login_recaptcha_opts) && isset($login_recaptcha_opts['secret_key'])) {
        $secret_key = $login_recaptcha_opts['secret_key'];
    }
}

if (!empty($secret_key)) {
    $verify_url = 'https://www.google.com/recaptcha/api/siteverify';
    $response = wp_remote_post($verify_url, [
        'body' => [
            'secret' => $secret_key,
            'response' => $recaptcha_response,
            'remoteip' => $_SERVER['REMOTE_ADDR']
        ]
    ]);
    
    if (is_wp_error($response)) {
        error_log('[CTWPML] Signup - Erro ao verificar reCAPTCHA: ' . $response->get_error_message());
        wp_send_json_error(['message' => 'Erro ao verificar reCAPTCHA. Tente novamente.']);
        return;
    }
    
    $response_body = json_decode(wp_remote_retrieve_body($response), true);
    
    if (!isset($response_body['success']) || $response_body['success'] !== true) {
        error_log('[CTWPML] Signup - reCAPTCHA invÃ¡lido');
        wp_send_json_error(['message' => 'reCAPTCHA invÃ¡lido. Por favor, tente novamente.']);
        return;
    }
    
    error_log('[CTWPML] Signup - reCAPTCHA validado com sucesso');
}
```


OBSERVAÃ‡ÃƒO IMPORTANTE:
  âš ï¸  O reCAPTCHA JÃ ESTÃ no formulÃ¡rio de "Criar conta" (linhas 87-90 do login-popup.php)
  âš ï¸  O que falta Ã© APENAS renderizar ele corretamente quando o popup abre
  âš ï¸  Seguir o PASSO 3 acima Ã© o mais importante!


ESTIMATIVA DE TEMPO: 1.5-2 horas
PRIORIDADE: ğŸŸ¡ ALTA (SeguranÃ§a)


================================================================================
ğŸŸ¡ PROBLEMA #6: LINK "ESQUECI MINHA SENHA" AUSENTE
================================================================================

DESCRIÃ‡ÃƒO DO PROBLEMA:
  â€¢ Falta o link "Perdeu a senha?" no formulÃ¡rio de login
  â€¢ UsuÃ¡rios nÃ£o conseguem recuperar senha facilmente
  â€¢ Plugin de referÃªncia tem este link implementado


ARQUIVO A MODIFICAR:
  â€¢ inc/frontend/login-popup.php


SOLUÃ‡ÃƒO: Adicionar link apÃ³s o botÃ£o de login
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Localizar a linha ~60 (apÃ³s </form> do login) e adicionar:

```php
        </form>
        
        <!-- â­ NOVO: Link "Perdeu a senha?" -->
        <div class="ctwpml-auth-footer" style="text-align: center; margin-top: 16px; margin-bottom: 8px;">
            <a href="<?php echo esc_url(wp_lostpassword_url(get_permalink())); ?>" 
               class="ctwpml-auth-link"
               style="color: var(--ctwpml-ui-primary, #0075FF); text-decoration: none; font-weight: 700;">
                Perdeu a senha?
            </a>
        </div>
    </div>
```

O CSS jÃ¡ estÃ¡ definido em login-popup.css (linha ~138):

```css
.ctwpml-auth-link {
  color: var(--ctwpml-ui-primary);
  text-decoration: none;
  font-weight: 800;
}

.ctwpml-auth-link:hover {
  text-decoration: underline;
}
```


ESTIMATIVA DE TEMPO: 10 minutos
PRIORIDADE: ğŸŸ¡ ALTA


================================================================================
ğŸŸ  PROBLEMA #7: BOTÃƒO DE LOGIN NÃƒO OCUPA 100% E COR INCORRETA
================================================================================

DESCRIÃ‡ÃƒO DO PROBLEMA:
  â€¢ BotÃ£o nÃ£o estÃ¡ ocupando 100% da largura
  â€¢ Cor do botÃ£o pode estar incorreta
  â€¢ Estilos do Elementor estÃ£o interferindo


ARQUIVO A MODIFICAR:
  â€¢ assets/css/login-popup.css


SOLUÃ‡ÃƒO: ForÃ§ar estilos do botÃ£o com !important
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Modificar a regra .ctwpml-auth-submit (linha ~151):

```css
.ctwpml-auth-submit {
  background-color: var(--ctwpml-ui-primary) !important;
  color: #fff !important;
  border: 0 !important;
  cursor: pointer !important;
  display: block !important;
  width: 100% !important;
  max-width: 100% !important;
  margin-top: 10px !important;
  padding: 12px !important;
  border-radius: 6px !important;
  font-weight: 800 !important;
  font-size: 15px !important;
  box-sizing: border-box !important;
  transition: opacity 0.2s ease !important;
}

.ctwpml-auth-submit:hover:not([disabled]) {
  opacity: 0.9 !important;
}

.ctwpml-auth-submit[disabled] {
  opacity: 0.6 !important;
  cursor: not-allowed !important;
}
```

Adicionar regra de alta especificidade para sobrescrever Elementor:

```css
/* ForÃ§a estilos mesmo com Elementor ativo */
.fancybox-content .ctwpml-login-popup .ctwpml-auth-submit,
body .fancybox-content .ctwpml-login-popup .ctwpml-auth-submit,
.ctwpml-login-popup .ctwpml-auth-form .ctwpml-auth-submit {
  background-color: #0075FF !important;
  width: 100% !important;
  display: block !important;
}
```


ESTIMATIVA DE TEMPO: 20 minutos
PRIORIDADE: ğŸŸ  MÃ‰DIA


================================================================================
ğŸŸ  PROBLEMA #8: FUNDO AZUL NAS ABAS (INFLUÃŠNCIA DO ELEMENTOR)
================================================================================

DESCRIÃ‡ÃƒO DO PROBLEMA:
  â€¢ Quando usuÃ¡rio clica em "Criar uma conta", a aba fica com fundo azul
  â€¢ Este fundo vem das configuraÃ§Ãµes do Elementor
  â€¢ O fundo deveria ser transparente durante a transiÃ§Ã£o


ARQUIVO A MODIFICAR:
  â€¢ assets/css/login-popup.css


SOLUÃ‡ÃƒO: ForÃ§ar background transparente
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Modificar as regras das abas (linhas ~47-75):

```css
.ctwpml-auth-tab {
  flex: 1;
  padding: 12px;
  border: 0;
  border-radius: 6px;
  background: transparent !important;
  font-weight: 800;
  font-size: 14px;
  cursor: pointer;
  color: var(--ctwpml-ui-primary);
  transition: all 0.2s ease;
}

.ctwpml-auth-tab .ctwpml-popup-h3 {
  margin: 0;
  font-weight: inherit;
}

/* Aba de Login nÃ£o-ativa: sem fundo */
.ctwpml-auth-tab[data-tab='login']:not(.is-active) {
  background: transparent !important;
  color: var(--ctwpml-ui-text);
}

/* Aba de Login ativa: fundo cinza claro */
.ctwpml-auth-tab.is-active[data-tab='login'] {
  background: #f5f5f5 !important;
  color: var(--ctwpml-ui-text) !important;
}

/* Aba de Signup nÃ£o-ativa: sem fundo */
.ctwpml-auth-tab[data-tab='signup']:not(.is-active) {
  background: transparent !important;
}

/* Aba de Signup ativa: fundo azul */
.ctwpml-auth-tab.is-active[data-tab='signup'] {
  background: var(--ctwpml-ui-primary) !important;
  color: #fff !important;
}
```

Adicionar regra para anular estilos do Elementor:

```css
/* Anula completamente estilos do Elementor nas abas */
.ctwpml-login-popup .ctwpml-auth-tab:not(.is-active),
body .ctwpml-login-popup .ctwpml-auth-tab:not(.is-active),
.fancybox-content .ctwpml-login-popup .ctwpml-auth-tab:not(.is-active) {
  background: transparent !important;
  background-color: transparent !important;
}
```


ESTIMATIVA DE TEMPO: 30 minutos
PRIORIDADE: ğŸŸ  MÃ‰DIA


================================================================================
âš ï¸  PROBLEMA #9: ENDEREÃ‡OS DEMORAM PARA APARECER (SEM FEEDBACK)
================================================================================

DESCRIÃ‡ÃƒO DO PROBLEMA:
  â€¢ ApÃ³s login, endereÃ§os demoram para aparecer
  â€¢ UsuÃ¡rio nÃ£o tem feedback visual durante o carregamento
  â€¢ Spinner jÃ¡ existe no cÃ³digo, sÃ³ precisa ser usado


ARQUIVO A MODIFICAR:
  â€¢ assets/js/address-ml-modal.js


SOLUÃ‡ÃƒO: Mostrar spinner durante carregamento
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Modificar a funÃ§Ã£o openModal (linha ~315):

ANTES:
```javascript
function openModal() {
    if (!isLoggedIn()) return;
    ensureModal();
    refreshFromCheckoutFields();
    loadAddresses(function () {
        showList();
        renderAddressList();
    });
    $('#ctwpml-address-modal-overlay').css('display', 'flex');
}
```

DEPOIS:
```javascript
function openModal() {
    if (!isLoggedIn()) return;
    ensureModal();
    refreshFromCheckoutFields();
    
    // â­ Mostrar modal imediatamente
    $('#ctwpml-address-modal-overlay').css('display', 'flex');
    
    // â­ Mostrar spinner enquanto carrega endereÃ§os
    showModalSpinner();
    logAny('Carregando endereÃ§os do usuÃ¡rio...', {});
    
    loadAddresses(function () {
        // â­ Esconder spinner apÃ³s carregar
        hideModalSpinner();
        logAny('EndereÃ§os carregados com sucesso', { 
            total: addressesCache.length 
        });
        
        showList();
        renderAddressList();
    });
}
```


ESTIMATIVA DE TEMPO: 15 minutos
PRIORIDADE: âš ï¸  MÃ‰DIA


================================================================================
âš ï¸  PROBLEMA #10 e #11: PERFORMANCE (LENTIDÃƒO E MÃšLTIPLOS update_checkout)
================================================================================

DESCRIÃ‡ÃƒO DO PROBLEMA:
  â€¢ Processamento lento (3-5 segundos, esperado: < 2s)
  â€¢ MÃºltiplas chamadas simultÃ¢neas de update_checkout
  â€¢ Causa race conditions e lentidÃ£o


ARQUIVO A MODIFICAR:
  â€¢ assets/js/woocommerce-events.js


SOLUÃ‡ÃƒO: Implementar debounce e prevenir chamadas redundantes
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Adicionar no INÃCIO do arquivo:

```javascript
/**
 * Controle de update_checkout para evitar chamadas redundantes
 */
var updateCheckoutTimer = null;
var updateCheckoutInProgress = false;
var lastUpdateCheckoutTime = 0;
var UPDATE_CHECKOUT_DEBOUNCE = 300; // 300ms
var UPDATE_CHECKOUT_MIN_INTERVAL = 500; // MÃ­nimo 500ms entre chamadas

/**
 * Triggera update_checkout de forma segura (com debounce)
 */
function triggerUpdateCheckoutSafe(source) {
    source = source || 'unknown';
    
    // Se jÃ¡ estÃ¡ em progresso, aguarda
    if (updateCheckoutInProgress) {
        console.log('[CTWPML] update_checkout jÃ¡ em progresso, ignorando (' + source + ')');
        return;
    }
    
    // Verifica intervalo mÃ­nimo desde Ãºltima chamada
    var now = Date.now();
    var timeSinceLastUpdate = now - lastUpdateCheckoutTime;
    
    if (timeSinceLastUpdate < UPDATE_CHECKOUT_MIN_INTERVAL) {
        console.log('[CTWPML] update_checkout muito recente, aguardando... (' + source + ')');
        
        // Agenda para depois
        if (updateCheckoutTimer) clearTimeout(updateCheckoutTimer);
        updateCheckoutTimer = setTimeout(function() {
            triggerUpdateCheckoutSafe(source);
        }, UPDATE_CHECKOUT_MIN_INTERVAL - timeSinceLastUpdate);
        return;
    }
    
    // Debounce
    if (updateCheckoutTimer) {
        clearTimeout(updateCheckoutTimer);
    }
    
    updateCheckoutTimer = setTimeout(function() {
        console.log('[CTWPML] Disparando update_checkout (' + source + ')');
        lastUpdateCheckoutTime = Date.now();
        updateCheckoutInProgress = true;
        jQuery(document.body).trigger('update_checkout');
    }, UPDATE_CHECKOUT_DEBOUNCE);
}

// Monitorar estado do update_checkout
jQuery(document).ready(function($) {
    $(document.body).on('update_checkout', function() {
        updateCheckoutInProgress = true;
    });
    
    $(document.body).on('updated_checkout', function() {
        updateCheckoutInProgress = false;
        console.log('[CTWPML] update_checkout concluÃ­do');
    });
});
```

Substituir todas as chamadas diretas de `trigger('update_checkout')` por `triggerUpdateCheckoutSafe('fonte')`:

ANTES:
```javascript
$(document.body).trigger('update_checkout');
```

DEPOIS:
```javascript
triggerUpdateCheckoutSafe('nome_da_fonte');
```


ESTIMATIVA DE TEMPO: 1 hora
PRIORIDADE: âš ï¸  MÃ‰DIA


================================================================================
ğŸ“Š RESUMO DE ESTIMATIVAS
================================================================================

ğŸ”´ PROBLEMAS CRÃTICOS:
   #1 - Erro seletor CSS          â†’ 2-3 horas
   #2 - store_webhook_shipping    â†’ 1-2 horas
   #3 - Mensagem de sucesso       â†’ 45 minutos
   #4 - WhatsApp nÃ£o salva        â†’ 1-1.5 horas
   
   SUBTOTAL CRÃTICO: 5-7.5 horas

ğŸŸ¡ PROBLEMAS ALTA PRIORIDADE:
   #5 - reCAPTCHA criar conta     â†’ 1.5-2 horas
   #6 - Link esqueci senha        â†’ 10 minutos
   
   SUBTOTAL ALTA: 1.5-2 horas

ğŸŸ  PROBLEMAS MÃ‰DIA PRIORIDADE:
   #7 - Layout botÃ£o              â†’ 20 minutos
   #8 - Fundo azul abas           â†’ 30 minutos
   #9 - Spinner endereÃ§os         â†’ 15 minutos
   #10/#11 - Performance          â†’ 1 hora
   
   SUBTOTAL MÃ‰DIA: 2 horas

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL DESENVOLVIMENTO: 8.5-11.5 horas
TESTES E VALIDAÃ‡ÃƒO: 3-4 horas
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL GERAL: 11.5-15.5 horas


================================================================================
âœ… CHECKLIST DE VALIDAÃ‡ÃƒO PÃ“S-IMPLEMENTAÃ‡ÃƒO
================================================================================

ğŸ”´ PROBLEMAS CRÃTICOS:
   [ ] #1 - Console sem erro "SyntaxError: '.' is not a valid selector"
   [ ] #1 - FunÃ§Ã£o safeSelector implementada e funcionando
   [ ] #2 - store_webhook_shipping retorna success=true
   [ ] #2 - Dados de frete salvos corretamente no perfil
   [ ] #3 - NotificaÃ§Ã£o verde aparece ao salvar endereÃ§o com sucesso
   [ ] #3 - NotificaÃ§Ã£o vermelha aparece em caso de erro
   [ ] #3 - Retorna para lista de endereÃ§os apÃ³s salvar
   [ ] #4 - WhatsApp salvo corretamente no perfil
   [ ] #4 - WhatsApp carregado corretamente ao abrir modal
   [ ] #4 - WhatsApp persistido entre sessÃµes

ğŸŸ¡ PROBLEMAS ALTA PRIORIDADE:
   [ ] #5 - reCAPTCHA aparece no formulÃ¡rio "Criar conta"
   [ ] #5 - reCAPTCHA validado antes do submit
   [ ] #5 - BotÃ£o desabilitado atÃ© completar reCAPTCHA
   [ ] #5 - ValidaÃ§Ã£o server-side do reCAPTCHA funcionando
   [ ] #6 - Link "Perdeu a senha?" aparece no login
   [ ] #6 - Link leva para pÃ¡gina correta de recuperaÃ§Ã£o

ğŸŸ  PROBLEMAS MÃ‰DIA PRIORIDADE:
   [ ] #7 - BotÃ£o ocupa 100% da largura
   [ ] #7 - Cor do botÃ£o correta (#0075FF)
   [ ] #8 - Abas nÃ£o-ativas sem fundo azul
   [ ] #8 - TransiÃ§Ã£o entre abas suave
   [ ] #9 - Spinner aparece ao carregar endereÃ§os
   [ ] #9 - Spinner desaparece apÃ³s carregar
   [ ] #10 - Tempo de carregamento < 2 segundos
   [ ] #11 - Sem mÃºltiplos update_checkout simultÃ¢neos

TESTES GERAIS:
   [ ] Fluxo completo de login funciona
   [ ] Fluxo completo de cadastro funciona
   [ ] Adicionar endereÃ§o funciona
   [ ] Editar endereÃ§o funciona
   [ ] Excluir endereÃ§o funciona
   [ ] WhatsApp e CPF salvos e carregados corretamente
   [ ] Testado em Chrome
   [ ] Testado em Firefox
   [ ] Testado em Safari
   [ ] Testado em mobile (iOS)
   [ ] Testado em mobile (Android)
   [ ] Console sem erros JavaScript
   [ ] Logs do servidor sem erros crÃ­ticos


================================================================================
ğŸ“ ARQUIVOS QUE SERÃƒO MODIFICADOS
================================================================================

JAVASCRIPT (6 arquivos):
   1. assets/js/checkout-tabs.js (ou tabs.js) - Adicionar safeSelector
   2. assets/js/ui.js - Substituir seletores perigosos
   3. assets/js/address-ml-modal.js - NotificaÃ§Ãµes, spinner, WhatsApp
   4. assets/js/login-signup.js - ValidaÃ§Ã£o reCAPTCHA (jÃ¡ existe)
   5. assets/js/woocommerce-events.js - Debounce update_checkout
   6. assets/js/webhook.js - PossÃ­veis seletores perigosos

PHP (3 arquivos):
   1. inc/ajax-store-webhook-shipping.php - Logs e validaÃ§Ãµes
   2. inc/frontend/login-popup.php - reCAPTCHA e link senha
   3. inc/frontend/addresses-api.php - Salvar/carregar WhatsApp

CSS (1 arquivo):
   1. assets/css/login-popup.css - BotÃ£o e abas


================================================================================
ğŸ¯ ESTRATÃ‰GIA DE IMPLEMENTAÃ‡ÃƒO RECOMENDADA
================================================================================

FASE 1 - CORREÃ‡Ã•ES CRÃTICAS (DIA 1-2):
   1. Implementar safeSelector e corrigir erros de seletor (#1)
   2. Corrigir store_webhook_shipping (#2)
   3. Testar e validar que nÃ£o hÃ¡ mais erros crÃ­ticos
   
FASE 2 - FEEDBACK VISUAL (DIA 2-3):
   4. Adicionar notificaÃ§Ãµes de sucesso/erro (#3)
   5. Corrigir salvamento do WhatsApp (#4)
   6. Adicionar spinner no carregamento de endereÃ§os (#9)
   7. Testar fluxo completo de ediÃ§Ã£o de endereÃ§os
   
FASE 3 - SEGURANÃ‡A E UX (DIA 3-4):
   8. Integrar reCAPTCHA em "Criar conta" (#5)
   9. Adicionar link "Esqueci minha senha" (#6)
   10. Testar fluxo completo de cadastro e login
   
FASE 4 - LAYOUT E PERFORMANCE (DIA 4-5):
   11. Corrigir layout do botÃ£o (#7)
   12. Remover fundo azul das abas (#8)
   13. Implementar debounce do update_checkout (#10, #11)
   14. Testes finais de performance e layout


================================================================================
ğŸ”— REFERÃŠNCIAS E CONTEXTO
================================================================================

ğŸ“ PLUGIN DE REFERÃŠNCIA (para reCAPTCHA):
   C:\Users\Dell\Desktop\checkout-tab-estilo-ml-2026\dados de entrega\
   popup login que tem recaptcha\plugin de popup de login que tem recatpcha.php
   
   âš ï¸  IMPORTANTE: Este plugin JÃ TEM o reCAPTCHA funcionando perfeitamente.
                   Copiar a implementaÃ§Ã£o de lÃ¡ (linhas 22-52).

ğŸ“Š LOGS DE DEBUG ANALISADOS:
   â€¢ 27+ ocorrÃªncias do erro de seletor CSS
   â€¢ 1 falha crÃ­tica em store_webhook_shipping
   â€¢ Tempo mÃ©dio de processamento: 3-5 segundos
   â€¢ MÃºltiplas chamadas simultÃ¢neas de update_checkout detectadas

ğŸ“ DOCUMENTOS DE REFERÃŠNCIA:
   â€¢ RELATORIO_TESTE_ULTIMA_VERSAO.txt (anÃ¡lise detalhada)
   â€¢ PLANO_DE_ACAO_CORRECOES.txt (implementaÃ§Ã£o passo a passo)
   â€¢ RESUMO_EXECUTIVO_TESTES.txt (visÃ£o geral)
   â€¢ VISAO_GERAL_PROBLEMAS.txt (mapa visual)


================================================================================
ğŸ’¡ NOTAS IMPORTANTES PARA O DESENVOLVEDOR
================================================================================

1. SEMPRE testar em ambiente de desenvolvimento primeiro
2. SEMPRE fazer backup antes de modificar arquivos
3. SEMPRE adicionar logs detalhados para facilitar debug futuro
4. SEMPRE validar entrada de usuÃ¡rio antes de processar
5. NÃƒO remover logs existentes, apenas adicionar novos
6. NÃƒO usar alert(), usar notificaÃ§Ãµes toast (funÃ§Ã£o showNotification)
7. NÃƒO fazer mÃºltiplas modificaÃ§Ãµes sem testar entre elas
8. SEMPRE verificar console do navegador apÃ³s cada modificaÃ§Ã£o
9. SEMPRE testar em mobile apÃ³s modificaÃ§Ãµes de layout
10. SEMPRE verificar logs do servidor apÃ³s modificaÃ§Ãµes PHP


================================================================================
ğŸ†˜ SUPORTE E DÃšVIDAS
================================================================================

Se houver dÃºvidas durante a implementaÃ§Ã£o:

1. Consultar o PLUGIN DE REFERÃŠNCIA (reCAPTCHA)
2. Consultar logs do navegador (Console)
3. Consultar logs do servidor (error_log)
4. Verificar documentos de referÃªncia listados acima
5. Testar em ambiente isolado antes de aplicar em produÃ§Ã£o


================================================================================
âœ… CONCLUSÃƒO
================================================================================

Este documento consolida TODOS os problemas identificados nos testes e fornece
soluÃ§Ãµes detalhadas e prontas para implementaÃ§Ã£o.

Seguindo as instruÃ§Ãµes passo a passo, todos os problemas serÃ£o corrigidos em
aproximadamente 11.5-15.5 horas de trabalho (desenvolvimento + testes).

Priorize sempre os problemas CRÃTICOS (ğŸ”´) primeiro, depois os de ALTA
prioridade (ğŸŸ¡), e por fim os de MÃ‰DIA prioridade (ğŸŸ ).

ApÃ³s implementar cada correÃ§Ã£o, marque o item correspondente no checklist de
validaÃ§Ã£o e teste antes de prosseguir para o prÃ³ximo problema.

BOA SORTE NA IMPLEMENTAÃ‡ÃƒO! ğŸš€


================================================================================
FIM DO DOCUMENTO
================================================================================

